import StampDuty from "./stamp-duty.js";

[
  {
    price: 3900000,
    buyerType: "additionalHome",
    tax: 0,
    percent: 0,
    total: 3900000,
  },
  {
    price: 4000000,
    buyerType: "additionalHome",
    tax: 120000,
    percent: 3,
    total: 4120000,
  },
  {
    price: 12500000,
    buyerType: "additionalHome",
    tax: 375000,
    percent: 3,
    total: 12875000,
  },
  {
    price: 18500000,
    buyerType: "additionalHome",
    tax: 675000,
    percent: 3.65,
    total: 19175000,
  },
  {
    price: 27500000,
    buyerType: "additionalHome",
    tax: 1200000,
    percent: 4.36,
    total: 28700000,
  },
  {
    price: 30001900,
    buyerType: "additionalHome",
    tax: 1400100,
    percent: 4.67,
    total: 31402000,
  },
  {
    price: 31000000,
    buyerType: "additionalHome",
    tax: 1480000,
    percent: 4.78,
    total: 32480000,
  },
  {
    price: 40001200,
    buyerType: "additionalHome",
    tax: 2200000,
    percent: 5.5,
    total: 42201200,
  },
  {
    price: 49000000,
    buyerType: "additionalHome",
    tax: 2920000,
    percent: 5.96,
    total: 51920000,
  },
  {
    price: 51000000,
    buyerType: "additionalHome",
    tax: 3080000,
    percent: 6.04,
    total: 54080000,
  },
  {
    price: 93700000,
    buyerType: "additionalHome",
    tax: 6556000,
    percent: 7.0,
    total: 100256000,
  },
  {
    price: 98888200,
    buyerType: "additionalHome",
    tax: 7230400,
    percent: 7.31,
    total: 106118600,
  },
  {
    price: 210000000,
    buyerType: "additionalHome",
    tax: 22875000,
    percent: 10.89,
    total: 232875000,
  },
  {
    price: 3900000,
    buyerType: "nextHome",
    tax: 0,
    percent: 0,
    total: 3900000,
  },
  {
    price: 4000000,
    buyerType: "nextHome",
    tax: 0,
    percent: 0,
    total: 4000000,
  },
  {
    price: 12500000,
    buyerType: "nextHome",
    tax: 0,
    percent: 0,
    total: 12500000,
  },
  {
    price: 18500000,
    buyerType: "nextHome",
    tax: 120000,
    percent: 0.65,
    total: 18620000,
  },
  {
    price: 27500000,
    buyerType: "nextHome",
    tax: 375000,
    percent: 1.36,
    total: 27875000,
  },
  {
    price: 30001900,
    buyerType: "nextHome",
    tax: 500000,
    percent: 1.67,
    total: 30501900,
  },
  {
    price: 31000000,
    buyerType: "nextHome",
    tax: 550000,
    percent: 1.78,
    total: 31550000,
  },
  {
    price: 40001200,
    buyerType: "nextHome",
    tax: 1000000,
    percent: 2.5,
    total: 41001200,
  },
  {
    price: 49000000,
    buyerType: "nextHome",
    tax: 1450000,
    percent: 2.96,
    total: 50450000,
  },
  {
    price: 51000000,
    buyerType: "nextHome",
    tax: 1550000,
    percent: 3.04,
    total: 52550000,
  },
  {
    price: 93700000,
    buyerType: "nextHome",
    tax: 3745000,
    percent: 4.0,
    total: 97445000,
  },
  {
    price: 98888200,
    buyerType: "nextHome",
    tax: 4263800,
    percent: 4.31,
    total: 103152000,
  },
  {
    price: 210000000,
    buyerType: "nextHome",
    tax: 16575000,
    percent: 7.89,
    total: 226575000,
  },
  {
    price: 3900000,
    buyerType: "firstTimeBuyer",
    tax: 0,
    percent: 0,
    total: 3900000,
  },
  {
    price: 4000000,
    buyerType: "firstTimeBuyer",
    tax: 0,
    percent: 0,
    total: 4000000,
  },
  {
    price: 12500000,
    buyerType: "firstTimeBuyer",
    tax: 0,
    percent: 0,
    total: 12500000,
  },
  {
    price: 18500000,
    buyerType: "firstTimeBuyer",
    tax: 0,
    percent: 0,
    total: 18500000,
  },
  {
    price: 27500000,
    buyerType: "firstTimeBuyer",
    tax: 0,
    percent: 0,
    total: 27500000,
  },
  {
    price: 30001900,
    buyerType: "firstTimeBuyer",
    tax: 0,
    percent: 0,
    total: 30001900,
  },
  {
    price: 31000000,
    buyerType: "firstTimeBuyer",
    tax: 50000,
    percent: 0.16,
    total: 31050000,
  },
  {
    price: 40001200,
    buyerType: "firstTimeBuyer",
    tax: 500000,
    percent: 1.25,
    total: 40501200,
  },
  {
    price: 49000000,
    buyerType: "firstTimeBuyer",
    tax: 950000,
    percent: 1.94,
    total: 49950000,
  },
  {
    price: 51000000,
    buyerType: "firstTimeBuyer",
    tax: 1550000,
    percent: 3.04,
    total: 52550000,
  },
  {
    price: 93700000,
    buyerType: "firstTimeBuyer",
    tax: 3745000,
    percent: 4.0,
    total: 97445000,
  },
  {
    price: 98888200,
    buyerType: "firstTimeBuyer",
    tax: 4263800,
    percent: 4.31,
    total: 103152000,
  },
  {
    price: 210000000,
    buyerType: "firstTimeBuyer",
    tax: 16575000,
    percent: 7.89,
    total: 226575000,
  },
].forEach((testCase) => {
  expect.extend({
    toBeWithinRange(received, floor, ceiling) {
      const pass = received >= floor && received <= ceiling;
      if (pass) {
        return {
          message: () =>
            `expected ${received} not to be within range ${floor} - ${ceiling}`,
          pass: true,
        };
      } else {
        return {
          message: () =>
            `expected ${received} to be within range ${floor} - ${ceiling}`,
          pass: false,
        };
      }
    },
  });

  const calculate = (price, buyerType) => {
    return new StampDuty(price, buyerType).calculate();
  };

  let title = "[" + testCase.buyerType + "]";

  it(
    "calculates for a " +
      title +
      " with a price of " +
      testCase.price +
      " at " +
      testCase.tax +
      " (" +
      testCase.percent +
      "%)",
    () => {
      let result = calculate(testCase.price, testCase.buyerType);
      expect(result.tax).toEqual(testCase.tax);
      expect(result.percentage).toBeWithinRange(
        testCase.percent - 0.01,
        testCase.percent + 0.01
      );
      expect(result.total).toEqual(testCase.total);
    }
  );
});
